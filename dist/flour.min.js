var flour=flour||{};flour.instanceId=1,flour.app=function(e,t){if(!(this instanceof flour.app))return new flour.app(name,t);var r=this;r.el=$('<div class="flour-app"></div>'),r.currentView=void 0,r.currentParams=void 0,r.view=void 0,r.el.on("click","a",function(e){if(1!==e.button&&!e.metaKey){if($target=$(e.currentTarget),$target.hasClass("classic")||$target.hasClass("ignore"))return void e.stopPropagation();e.preventDefault();var t=$target.attr("href");if(void 0!==t){var r=!1;$target.hasClass("silent")&&(r=!0);var i={silent:r};flour.pushState(t,i)}}}),r.loadView=function(){if(r.view.ready===!1){var e=function(){r.displayView(),r.view.off("ready",e)};r.view.on("ready",e)}else r.displayView()},r.displayView=function(){r.el.empty(),void 0!==r.view.willDisplay&&r.view.willDisplay(),r.el.append(r.view.el)};var i=new flour.router(t.routes,t.base_path);flour.subscribe("route:change",function(e){void 0!==flour.views[e.view]&&((e.view!==r.currentView||JSON.stringify(e.params)!==JSON.stringify(r.currentParams))&&(void 0!==r.currentView&&r.view.destroy(),r.view=flour.getView(e.view,e.params),r.loadView(),r.currentView=e.view,r.currentParams=e.params),void 0!==e.action&&void 0!==r.view[e.action]&&r.view[e.action](e.params))}),i.matchCurrentRequest()};var flour=flour||{};flour.bind={},flour.bind.binders={},flour.bind.prefix="flour",flour.addBinder=function(e,t){flour.bind.binders[e]=t},flour.bindView=function(e){var t=[],r=[],i=flour.bind.prefix;e.on("render",function(){for(var n=0,o=r.length;o>n;n++){var l=r[n];e.off(l.eventName,l.eventCallback)}for(var u in flour.bind.binders)!function(){var n=flour.bind.binders[u],o=i+"-"+u;t.length=0,t=e.find("["+o+"]"),t.each(function(t,i){var l=$(i),u=l.attr(o),s=!1,a=void 0;n.attach&&n.attach(l,u,e),u=u.replace(/\s/g,"");var f=-1===u.indexOf("|")?!1:!0;if(f){var v=u.split("|");if(u=v[0],s=v[1],-1!==s.indexOf(":")){var v=s.split(":");s=v[0],a=v[1];var c=a.length-1;"'"!==a[0]&&'"'!==a[0]||"'"!==a[c]&&'"'!==a[c]||(a=a.substring(1,c))}}var d="model."+u+":change",p=function(e){e=h(e),n.update(l,e)},h=function(t){return s&&(void 0!==flour.filters[s]?t=flour.filters[s](t,a):void 0!==e[s]&&(t=e[s](t,a))),t};if(n.update){r.push({eventName:d,eventCallback:p}),e.on(d,p);var g=e.get(u);g=h(g),n.update(l,g)}})}()})},flour.bindList=function(e,t){var r=[],i=flour.bind.prefix,n=$(flour.getTemplate(t)({}));for(var o in flour.bind.binders)!function(){var t=(flour.bind.binders[o],i+"-"+o);r.length=0,r=n.find("["+t+"]"),r.each(function(r,i){var n=$(i),l=n.attr(t);l=l.replace(/\s/g,"");var l=(-1===l.indexOf("|")?!1:!0,n.attr(t)),u="["+t+'="'+l+'"]';e.addBinding(o,l,u)})}()};var flour=flour||{};flour.addBinder("html",{update:function(e,t){e.html(t)}}),flour.addBinder("text",{update:function(e,t){e.text(t)}}),flour.addBinder("value",{attach:function(e,t,r){var i=e[0].nodeName;if("INPUT"===i||"TEXTAREA"===i){var n=e[0].type;"checkbox"===n?e.on("change",function(){var i=e.prop("checked");r.set(t,i,!1)}):"radio"===n?e.on("change",function(){var i=e.val();r.set(t,i,!1)}):e.on("keypress change keyup",function(){var i=e.val();r.set(t,i,!1)})}"SELECT"===i&&e.on("change",function(){var i=e.val();r.set(t,i,!1)})},update:function(e,t){var r=(e[0].nodeName,e[0].type);"checkbox"===r?e.prop("checked",t):"radio"===e.attr("type")?e.val()===t&&e.prop("checked",!0):e.val()!==t&&e.val(t)}}),flour.addBinder("show",{update:function(e,t){t?e.css("display","block"):e.css("display","none")}}),flour.addBinder("show-inline",{update:function(e,t){t?e.css("display","inline"):e.css("display","none")}}),flour.addBinder("hide",{update:function(e,t){t?e.css("display","none"):e.css("display","block")}}),flour.addBinder("class",{update:function(e,t){var r=e.data("last-class");r&&e.removeClass(r),e.data("last-class",t),e.addClass(t)}}),flour.addBinder("view",{attach:function(e,t,r){r[t]&&e.append(r[t].el)}}),flour.addBinder("name",{attach:function(e,t,r){r[t]=null,r[t]=e}});var flour=flour||{};flour.filters={},flour.addFilter=function(e,t){flour.filters[e]=t};var flour=flour||{};flour.addFilter("json_format",function(e,t){var r=void 0===t?2:parseInt(t);return JSON.stringify(e,void 0,r)}),Handlebars.registerHelper("link_to",function(e){return flour.config("base_url")+"/"+e}),Handlebars.registerHelper("render_template",function(e,t){return flour.getTemplate(e)({data:t})});var flour=flour||{};flour.helpers={},flour.addHelper=function(e,t){flour.helpers[e]=t},flour.getHelper=function(e){return flour.isFunction(flour.helpers[e])&&(flour.helpers[e]=new flour.helpers[e]),flour.helpers[e]};var flour=flour||{};flour.requestHandler=function(e,t,r){r[t]&&r[t](e)},flour.request={get:function(e,t,r){this.doRequest(e,t,r,"get")},put:function(e,t,r){this.doRequest(e,t,r,"put")},post:function(e,t,r){this.doRequest(e,t,r,"post")},"delete":function(e,t,r){this.doRequest(e,t,r,"delete")},doRequest:function(e,t,r,i){r.silent!==!0&&flour.publish("http-request:start"),$.ajax({url:e,type:i,data:t,success:function(e,t){r.silent!==!0&&flour.publish("http-request:end"),flour.requestHandler(e,t,r)}})}},flour.http=function(e,t,r){void 0===t&&(t="get");var i=function(e,t){if(void 0!==e)for(var r in e)if(-1!==t.indexOf(":"+r)){var i=":"+r;t=t.replace(i,e[r]),delete e[r]}return t};return function(n,o){var n=flour.clone(n),l=i(n,e);o.silent!==!0&&flour.publish("http-request:start");var u={url:l,type:t,data:n,success:function(e,t){o.silent!==!0&&flour.publish("http-request:end"),flour.requestHandler(e,t,o)}};if(void 0!==r)for(var s in r)u[s]=r[s];$.ajax(u)}};var flour=flour||{};flour.lists={},flour.addList=function(e,t){t.prototype=new flour.baseList,flour.lists[e]=t},flour.getList=function(e,t){var r=new flour.lists[e];return r.eventListeners={},r.subscriptions=[],r.lookup={},r.views=[],r.list=[],r.raw=[],r.el=null,r.id=flour.instanceId,flour.instanceId++,flour.publish("flour:list_create",{name:e,list:r}),r.initialize(t),r},flour.baseList=function(){var e=this;e.initialize=function(e){var t=this;t.key=t.key?t.key:!1,t.events=t.events?t.events:{},t.itemElClass=t.itemElClass?t.itemElClass:"",t.itemElType=t.itemElType?t.itemElType:"div",t.wrapElType=t.wrapElType?t.wrapElType:"div",t.el=$("<"+t.wrapElType+' class="flour-list"></'+t.wrapElType+">"),t.addHelpers(),t.addEvents(),t.init(e)},e.generateLookup=function(){var e=this;if(e.raw.length=0,e.lookup={},!e.key){for(var t=0,r=e.list.length;r>t;t++){var i=e.list[t].data;e.raw.push(i)}return void e.trigger("change",e.raw)}for(var t=0,r=e.list.length;r>t;t++){var i=e.list[t].data;e.raw.push(i),e.lookup[i[e.key]]=t}e.trigger("change",e.raw)},e.getItem=function(e){var t=this;return t.list[t.getItemIndex(e)]},e.getItemIndex=function(e){var t=this;return t.key?t.lookup[e]:e},e.addEvents=function(){var e=this;if(void 0!==e.events)for(var t in e.events)!function(){var r=e.events[t],i=t.split(" "),n=i.pop(),o=i.join(" ");void 0!==e[r]?e.el.on(o,n,function(t){var i=$(t.currentTarget);e[r](t,i)}):flour.isFunction(r)&&e.el.on(o,n,function(e){var t=$(e.currentTarget);r(e,t)})}()},e.addHelpers=function(){var e=this;if(void 0!==e.helpers)for(var t=0,r=e.helpers.length;r>t;t++){var i=e.helpers[t];e[i]=flour.getHelper(i),void 0!==e[i].init&&e[i].init(e)}},e.find=function(e){var t=this;return t.el.find(e)},e.add=function(e,t){var r=this,i=function(e){if(void 0===r.lookup[e[r.key]]){void 0===t?e.index=r.list.length:t>r.list.length?(t=void 0,e.index=r.list.length):e.index=t;var i=$("<"+r.itemElType+">");i.attr("class",r.itemElClass);var n={data:e,el:i};if(r.renderItem(n),void 0===t)r.list.push(n),r.el.append(i);else if(t>0){var e=r.list[t-1];r.list.splice(t,0,n),e.el.after(i)}else r.list.splice(0,0,n),r.el.prepend(i)}};if(flour.isArray(e))for(var n=0,o=e.length;o>n;n++)i(e[n]),void 0!==t&&t++;else i(e);return r.generateLookup(),void 0===t?r.list.length:t},e.remove=function(e){var t=this,e=t.getItemIndex(e),r=t.list[e];return r?(r.el.remove(),r.data=null,t.list.splice(e,1),t.generateLookup(),e):!1},e.removeAll=function(){for(var e=this,t=0,r=e.list.length;r>t;t++){var i=e.list[t];i.el.remove(),i.data=null}e.list.length=0,e.generateLookup()},e.move=function(e,t){var r=this,i=r.getItem(e),n=r.getItemIndex(e),o=n>t?"up":"down";if(t>r.list.length&&(t=r.list.length),t>0){var l="up"===o?r.list[t-1]:r.list[t];l.el.after(i.el)}else r.el.prepend(i.el);r.list.splice(t,0,r.list.splice(n,1)[0]),r.generateLookup()},e.set=function(e,t,r,i){var n=this,o=n.getItem(e);n.setItem(o,t,r,i)},e.setItem=function(e,t,r,i){{var n=this,o=e.data,i=void 0===i?!0:i;flour.setObjectKeyValue(o,t,r)}i&&"index"!==t&&n.key&&n.renderItem(e),n.trigger("change",n.raw)},e.get=function(e,t){var r=this,i=r.getItem(e);return flour.getObjectKeyValue(i.data,t)},e.renderItem=function(e){var t=this;e.el.html(flour.getTemplate(t.template)(e.data))},e.on=function(e,t){var r=this;void 0===r.eventListeners[e]&&(r.eventListeners[e]=[]),r.eventListeners[e].push(t)},e.off=function(e,t){var r=this,i=r.eventListeners[e];if(void 0!==i)if(void 0!==t){for(var n=0,o=i.length;o>n;n++)if(t===i[n]){i[n]=null;break}}else i.length=0},e.trigger=function(e,t){var r=this,i=r.eventListeners[e];if(void 0!==i&&null!==i)for(var n=0,o=i.length;o>n;n++){var l=i[n];null!==l&&void 0!==l&&l(t)}},e.subscribe=function(e,t){{var r=this;flour.subscribe(e,t)}r.subscriptions.push({eventName:e,callback:t})},e.getView=function(e,t){var r=this,i=flour.getView(e,t);return r.views.push(i),i},e.getList=function(e,t){var r=this,i=flour.getList(e,t);return r.views.push(i),i},e.destroy=function(){var e=this;e.trigger("destroy"),e.el.off();for(var t=0,r=e.subscriptions.length;r>t;t++){var i=e.subscriptions[t];flour.unsubscribe(i.eventName,i.callback)}for(var t=0,r=e.views.length;r>t;t++){var n=e.views[t];n.destroy()}for(var o in e.eventListeners)e.eventListeners[o]=null;void 0!==e.postDestroy&&e.postDestroy(),flour.publish("flour:list_destroy",e.id)}};var flour=flour||{};flour.log=function(e,t){void 0!==flour.logView&&flour.logView.log(e,t)};var flour=flour||{};flour.subscriptions={},flour.publish=function(e,t){var r=flour.subscriptions[e];if(void 0!==r)for(var i=0,n=r.length;n>i;i++)r[i]&&r[i](t)},flour.subscribe=function(e,t){void 0===flour.subscriptions[e]&&(flour.subscriptions[e]=[]),flour.subscriptions[e].push(t)},flour.unsubscribe=function(e,t){if(void 0!==flour.subscriptions[e])for(var r=0,i=flour.subscriptions[e].length;i>r;r++)t===flour.subscriptions[e][r]&&flour.subscriptions[e].splice(r,1)};var flour=flour||{};flour.store={values:{},set:function(e,t,r){var i=this,n=flour.setObjectKeyValue(i.values,e,t);if(r!==!1){var o=n[0],l=i.values[o];flour.publish(o+":change",l)}flour.publish("flour:store_update",i.values)},get:function(e){var t=this;if(!e)return t.values;var r=flour.getObjectKeyValue(t.values,e);return flour.clone(r)}};var flour=flour||{};flour.templates={},flour.addTemplate=function(e,t){flour.templates[e]=Handlebars.compile(t)},flour.getTemplate=function(e){return void 0!==e&&void 0!==flour.templates[e]?flour.templates[e]:(void 0===flour.templates["flour:missing_template"]&&flour.addTemplate("flour:missing_template","<div>Missing template.</div>"),flour.templates["flour:missing_template"])};var flour=flour||{};flour.pushState=function(e,t,r){r=void 0===r?flour.config("title"):r,t=void 0===t?{}:t,history.pushState(t,r,e),flour.publish("history:state_change",t)},flour.isObject=function(e){return"object"==typeof e&&null!==e?!0:!1},flour.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)?!0:!1},flour.isFunction=function(e){var t={};return e&&"[object Function]"===t.toString.call(e)},flour.isString=function(e){return"string"==typeof e||e instanceof String?!0:!1},flour.clone=function(e){var t;if(null==e||"object"!=typeof e)return e;if(e instanceof Date)return t=new Date,t.setTime(e.getTime()),t;if(e instanceof Array){t=[];for(var r=0,i=e.length;i>r;r++)t[r]=flour.clone(e[r]);return t}if(e instanceof Object){t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=flour.clone(e[n]));return t}throw new Error("Unable to copy obj! Its type isn't supported.")},flour.pluralize=function(e,t){return 1===t?e:e+"s"},flour.rgb2hex=function(e){function t(e){return("0"+parseInt(e).toString(16)).slice(-2)}return/^#[0-9A-F]{6}$/i.test(e)?e:(e=e.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/),"#"+t(e[1])+t(e[2])+t(e[3]))},flour.readableBytes=function(e){if(e=parseInt(e),0===e)return 0;var t=["bytes","kB","MB","GB","TB","PB"],r=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,Math.floor(r))).toFixed(2)+" "+t[r]},flour.truncate=function(e,t){if(e&&e.length>t&&e.length>0){var r=e+" ";return r=e.substr(0,t),r=e.substr(0,r.lastIndexOf(" ")),r=r.length>0?r:e.substr(0,t)}return e},flour.defer=function(e){setTimeout(e,0)},flour.setObjectKeyValue=function(e,t,r){if(e&&t){var i=-1===t.indexOf(".")?!1:!0,n=-1===t.indexOf("[")?!1:!0;if(n||i){t=t.replace(/\]|'|"/g,"");for(var o=t.split(/\.|\[/g),l=e,u=o.length,s=u-1,a=0;u>a;a++){var f=o[a];a===s?l[f]=r:(l[f]||(l[f]={}),l=l[f])}return o}return e[t]=r,[t]}},flour.getObjectKeyValue=function(e,t){if(e&&t){var r=-1===t.indexOf(".")?!1:!0,i=-1===t.indexOf("[")?!1:!0;if(!i&&!r)return e[t];t=t.replace(/\]|'|"/g,"");for(var n=t.split(/\.|\[/g),o=e,l=n.length,u=l-1,s=0;l>s;s++){var a=n[s];if(s===u)return o[a];if(!o[a])return void 0;o=o[a]}}},flour.configValues={},flour.config=function(e,t){if(void 0===e)return flour.configValues;if(flour.isObject(e))for(var r in e)flour.configValues[r]=e[r];else{if(void 0===t)return flour.configValues[e];flour.configValues[e]=t}},flour.generateLookup=function(e,t){if(flour.isArray(e)){for(var r={},i=0,n=e.length;n>i;i++){var o=e[i];o[t]&&(r[o[t]]=i)}return r}return!1},flour.validateFormData=function(e){var t={},r={},i=!1,n=e.find("input, textarea, select");return $.each(n,function(e,n){$input=$(n);var o=$input.attr("name");if("select-multiple"===$input[0].type){var l=[],u=$input.find("option");$.each(u,function(e,t){var r=$(t);r.data("selected")&&l.push(r.attr("value"))}),t[o]=l}else if("checkbox"===$input[0].type){var l=$input[0].checked?!0:!1;t[o]=l}else if("radio"===$input[0].type){if($input[0].checked){var l=$input.val();t[o]=l}}else{var l=$input.val();t[o]=l}$input.hasClass("validate")&&("select-multiple"===$input[0].type?0===l.length&&(r[o]="empty",i=!0):(""===l||l===!1)&&(r[o]="empty",i=!0)),$input.hasClass("validate-email")&&(flour.test.email(l)||(r[o]="invalid",i=!0))}),{data:t,errors:i?r:!1}};var flour=flour||{};flour.test={email:function(e){var t=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return t.test(e)}};var flour=flour||{};flour.views={},flour.addView=function(e,t){t.prototype=new flour.baseView,flour.views[e]=t},flour.getView=function(e,t){var r=new flour.views[e];return r.eventListeners={},r.subscriptions=[],r.model={},r.views=[],r.el=null,r.id=flour.instanceId,flour.instanceId++,flour.publish("flour:view_create",{name:e,view:r}),r.initialize(t),r},flour.baseView=function(){var e=this;e.initialize=function(e){var t=this;t.events=t.events?t.events:{},t.el=$('<div class="flour-view"></div>'),t.addHelpers(),t.addEvents(),flour.bindView(t),t.init(e)},e.addEvents=function(){var e=this;if(void 0!==e.events)for(var t in e.events)!function(){var r=e.events[t],i=t.split(" "),n=i.pop(),o=i.join(" ");void 0!==e[r]?e.el.on(o,n,function(t){var i=$(t.currentTarget);e[r](t,i)}):flour.isFunction(r)&&e.el.on(o,n,function(e){var t=$(e.currentTarget);r(e,t)})}()},e.addHelpers=function(){var e=this;if(void 0!==e.helpers)for(var t=0,r=e.helpers.length;r>t;t++){var i=e.helpers[t];e[i]=flour.getHelper(i),void 0!==e[i].init&&e[i].init(e)}},e.find=function(e){var t=this;return t.el.find(e)},e.render=function(){var e=this;e.adoptTemplate(),e.trigger("render"),void 0!==e.postRender&&e.postRender()},e.adoptTemplate=function(){for(var e=this,t=0,r=e.views.length;r>t;t++)e.views[t].el.detach();var i=flour.getTemplate(e.template);e.el.html(i(e.model))},e.get=function(e){var t=this;return void 0===e?t.model:flour.getObjectKeyValue(t.model,e)},e.set=function(e,t,r){var i,n=this;if(flour.isObject(e))for(var o in e)n.model[o]=e[o];else{var l=flour.getObjectKeyValue(n.model,e);t!==l||flour.isArray(t)||flour.isObject(t)?i=flour.setObjectKeyValue(n.model,e,t):r=!1}if(r!==!1&&n.render(),i)for(var u=i.length,s=0;u>s;s++){var a=i.join(".");n.trigger("model."+a+":change",n.get(a)),i.pop()}},e.on=function(e,t){var r=this;void 0===r.eventListeners[e]&&(r.eventListeners[e]=[]),r.eventListeners[e].push(t)},e.off=function(e,t){var r=this,i=r.eventListeners[e];if(void 0!==i)if(void 0!==t){for(var n=0,o=i.length;o>n;n++)if(t===i[n]){i[n]=null;break}}else i.length=0},e.trigger=function(e,t){var r=this,i=r.eventListeners[e];if(void 0!==i&&null!==i)for(var n=0,o=i.length;o>n;n++){var l=i[n];null!==l&&void 0!==l&&l(t)}},e.subscribe=function(e,t){{var r=this;flour.subscribe(e,t)}r.subscriptions.push({eventName:e,callback:t})},e.getView=function(e,t){var r=this,i=flour.getView(e,t);return r.views.push(i),i},e.getList=function(e,t){var r=this,i=flour.getList(e,t);return r.views.push(i),i},e.destroy=function(){var e=this;e.trigger("destroy"),e.el.off();for(var t=0,r=e.subscriptions.length;r>t;t++){var i=e.subscriptions[t];flour.unsubscribe(i.eventName,i.callback)}for(var t=0,r=e.views.length;r>t;t++){var n=e.views[t];n.destroy()}for(var o in e.eventListeners)e.eventListeners[o]=null;void 0!==e.postDestroy&&e.postDestroy(),flour.publish("flour:view_destroy",e.id)}};